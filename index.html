<html>

<head>
    <title>Sample script for uploading file to Google Drive without authorization</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<script type="text/javascript">
		function codeAddress() {
			var e = document.getElementById("disp_image");
			var e_class = document.getElementById("img_class");
			var num = Math.floor(Math.random() * 5) + 1; // 0...6
			e.src = 'images/' + num + '.png';
			e_class.value = num;
		}
	</script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.js"></script>
</head>

<body onload="codeAddress();">
	
    <form id="input_form" id="form" method="post">
		<img id="disp_image" src="images/1.png" height="480" width="640"></img><br>
        Upload a file
		<div id="data"></div>	
        <input name="file" id="uploadfile" type="file">
		<input id="img_class" type="hidden" name="imageClass" value="">
        <input id="submit" type="submit">
    </form>
    <script>
    $('#uploadfile').on("change", function() {
        var file = this.files[0];
        var fr = new FileReader();
        fr.fileName = file.name
        fr.onload = function(e) {
            e.target.result
            html = '<input type="hidden" name="data" value="' + e.target.result.replace(/^.*,/, '') + '" >';
            html += '<input type="hidden" name="mimetype" value="' + e.target.result.match(/^.*(?=;)/)[0] + '" >';
            html += '<input type="hidden" name="filename" value="' + e.target.fileName + '" >';
            $("#data").empty().append(html);
        }
        fr.readAsDataURL(file);
    });
    </script>
	<script type="text/javascript">
		$(document).ready(function (e) {
			$("[id^=input_form]").on('submit',(function(e) {
				e.preventDefault();
				$.ajax({
					url: "https://script.google.com/macros/s/AKfycbxYwVh0L_jaHud6TOzzwCd6rAZ8_aJuaZc1iIy-mwszaoVJr24/exec",
					type: "POST",
					data:  new FormData(this),
					contentType: false,
							cache: false,
					processData:false,
					timeout:15000,
					beforeSend: function()
					{
						$("#targetLayer").html("Fetching");	
					},
					success: function(data)
						{

						$("#targetLayer").html(data);
						codeAddress();
						},
					error: function() 
						{
						$("#targetLayer").html("ERROR");
						}	        
				});
			}));
		});
	</script>
	<div id="targetLayer"></div>
</body>

</html>
